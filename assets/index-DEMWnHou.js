import{g as C,t as _}from"./main-sIgzr7l1.js";import{f as V}from"./role-VmjJPuXv.js";import{b as M,c as U,d as L,e as S,U as j,L as G,M as H,J,B as x,R as W,T as Y,r as K}from"./naive-ui-CQ2AL4ly.js";import{k as q,a9 as A,a6 as B,r as f,a7 as F,W as I,N as n,a2 as d,_ as o,j as b,e as T,Y as R,I as E}from"./vue-DuawIF-O.js";function Q(s){return C.request({url:"/user/pageList",method:"post",data:s})}function X(s){return C.request({url:"/user/add",method:"post",data:s})}function Z(s){return C.request({url:"/user/edit",method:"post",data:s})}function ee(s){return C.request({url:"/user/delete",method:"post",data:{id:s}})}function te(s){return C.request({url:"/user/password",method:"post",data:s})}const ne=q({__name:"AddOrEditModal",props:A({record:{}},{show:{type:Boolean,required:!0},showModifiers:{}}),emits:A(["success"],["update:show"]),setup(s,{emit:w}){const r=B(s,"show"),h=w,a=f({id:0,username:"",status:1,roleIds:[]}),p=F("formRef"),m={username:[{required:!0,message:"请输入账户名",trigger:["blur","input"]}],roleIds:[{required:!0,type:"array",message:"请绑定角色",trigger:["blur","change"]}],status:[{required:!0,message:"请选择状态",type:"number",trigger:["blur","change"]}]},c=f([]);async function P(){const[t,e]=await _(V());if(t){c.value=[];return}c.value=e}function g(){P(),s.record&&(a.value=T({...s.record}))}function u(){a.value={id:0,username:"",status:1,roleIds:[]}}const l=f(!1);async function y(){var i;const[t]=await _(p.value.validate());if(t)return!1;l.value=!0;const[e]=await _(s.record?Z(n(a)):X(n(a)));if(l.value=!1,!e)return(i=window.$message)==null||i.success(`${s.record?"编辑":"新增"}成功`),h("success"),!0}return(t,e)=>{const i=S,N=L,k=j,$=H,z=G,D=U,O=M;return R(),I(O,{show:r.value,"onUpdate:show":e[3]||(e[3]=v=>r.value=v),preset:"dialog",title:t.record?"编辑用户":"新增用户","positive-text":"确定","negative-text":"取消",loading:n(l),onAfterEnter:g,onAfterLeave:u,onPositiveClick:y},{default:d(()=>[o(D,{ref_key:"formRef",ref:p,model:n(a),rules:m,class:"my-8",size:"small","label-placement":"left","label-width":"auto"},{default:d(()=>[o(N,{label:"账户名",path:"username"},{default:d(()=>[o(i,{value:n(a).username,"onUpdate:value":e[0]||(e[0]=v=>n(a).username=v),placeholder:"账户名"},null,8,["value"])]),_:1}),o(N,{label:"角色绑定",path:"roleIds"},{default:d(()=>[o(k,{value:n(a).roleIds,"onUpdate:value":e[1]||(e[1]=v=>n(a).roleIds=v),options:n(c),multiple:"","label-field":"name","value-field":"id",placeholder:"请绑定角色"},null,8,["value","options"])]),_:1}),o(N,{label:"状态",path:"status"},{default:d(()=>[o(z,{value:n(a).status,"onUpdate:value":e[2]||(e[2]=v=>n(a).status=v)},{default:d(()=>[o($,{value:1},{default:d(()=>e[4]||(e[4]=[b("启用")])),_:1}),o($,{value:0},{default:d(()=>e[5]||(e[5]=[b("禁用")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","loading"])}}}),oe=q({__name:"PasswordModal",props:A({record:{}},{show:{type:Boolean,required:!0},showModifiers:{}}),emits:["update:show"],setup(s){const w=B(s,"show"),r=f({id:0,newPassword:"",confirmPassword:""}),h=F("formRef"),a={newPassword:{required:!0,message:"请输入新密码",trigger:["blur","input"]},confirmPassword:{required:!0,validator:(g,u)=>u?u!==r.value.newPassword?new Error("两次输入的密码不一致"):!0:new Error("请再次输入新密码"),trigger:["blur","input"]}};function p(){r.value={id:0,newPassword:"",confirmPassword:""}}function m(){s.record&&(r.value.id=s.record.id)}const c=f(!1);async function P(){var l;const[g]=await _(h.value.validate());if(g)return!1;c.value=!0;const[u]=await _(te(n(r)));if(c.value=!1,!u)return(l=window.$message)==null||l.success("修改密码成功"),!0}return(g,u)=>{const l=S,y=L,t=U,e=M;return R(),I(e,{show:w.value,"onUpdate:show":u[2]||(u[2]=i=>w.value=i),preset:"dialog",title:"修改密码","positive-text":"确定","negative-text":"取消",loading:n(c),onAfterEnter:m,onAfterLeave:p,onPositiveClick:P},{default:d(()=>[o(t,{ref_key:"formRef",ref:h,model:n(r),rules:a,class:"my-8",size:"small","label-placement":"left","label-width":"auto"},{default:d(()=>[o(y,{path:"newPassword",label:"新密码"},{default:d(()=>[o(l,{value:n(r).newPassword,"onUpdate:value":u[0]||(u[0]=i=>n(r).newPassword=i),type:"password",placeholder:"请输入新密码"},null,8,["value"])]),_:1}),o(y,{path:"confirmPassword",label:"确认密码"},{default:d(()=>[o(l,{value:n(r).confirmPassword,"onUpdate:value":u[1]||(u[1]=i=>n(r).confirmPassword=i),type:"password",placeholder:"请再次输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","loading"])}}}),le=q({name:"setting-user",__name:"index",setup(s){const w=f(!1),r=f([]),h=[{title:"id",key:"id",width:120},{title:"账户名",key:"username"},{title:"状态",key:"status",width:120,render(t){return o(Y,{type:t.status===1?"success":"error"},{default:()=>[t.status===1?"启用":"禁用"]})}},{title:"操作",key:"operation",width:260,fixed:"right",render(t){return o(K,null,{default:()=>[o(x,{type:"primary",onClick:()=>g(t)},{default:()=>[b("编辑")]}),o(x,{type:"primary",onClick:()=>y(t)},{default:()=>[b("修改密码")]}),o(x,{type:"error",onClick:()=>u(t)},{default:()=>[b("删除")]})]})}}],a=T({page:1,pageSize:10,itemCount:0,onChange:t=>{a.page=t,p()}});async function p(){w.value=!0;const[t,e]=await _(Q({current:a.page,size:a.pageSize}));if(w.value=!1,t){r.value=[];return}r.value=e.records,a.itemCount=e.total}p();const m=f(!1),c=f();function P(){c.value=void 0,m.value=!0}function g(t){c.value=t,m.value=!0}function u(t){const e=window.$dialog.warning({title:"温馨提示",content:`确定要删除“${t.username}”吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{e.loading=!0;const[i]=await _(ee(t.id));return e.loading=!1,i?!1:(window.$message.success("删除成功"),p(),!0)}})}const l=f(!1);function y(t){c.value=t,l.value=!0}return(t,e)=>{const i=W,N=J;return R(),I(N,null,{default:d(()=>[o(n(x),{type:"primary",onClick:P},{default:d(()=>e[2]||(e[2]=[b(" 新增用户")])),_:1}),o(i,{class:"mt-4",columns:h,data:n(r),loading:n(w),remote:"",pagination:n(a),"scroll-x":620},null,8,["data","loading","pagination"]),o(ne,{show:n(m),"onUpdate:show":e[0]||(e[0]=k=>E(m)?m.value=k:null),record:n(c),onSuccess:p},null,8,["show","record"]),o(oe,{show:n(l),"onUpdate:show":e[1]||(e[1]=k=>E(l)?l.value=k:null),record:n(c),onSuccess:p},null,8,["show","record"])]),_:1})}}});export{le as default};
