import{b as D,c as E,d as P,e as F}from"./role-VmjJPuXv.js";import{t as y,h as S}from"./main-sIgzr7l1.js";import{k as R,a9 as A,a6 as z,r as m,a7 as I,W as $,N as o,a2 as l,_ as n,j as p,e as M,Y as T,I as L}from"./vue-DuawIF-O.js";import{b as U,c as q,d as O,e as V,L as j,M as G,J as H,B as h,R as J,T as W,r as Y}from"./naive-ui-CQ2AL4ly.js";const K=R({__name:"AddOrEditModal",props:A({record:{}},{show:{type:Boolean,required:!0},showModifiers:{}}),emits:A(["success"],["update:show"]),setup(i,{emit:f}){const d=z(i,"show"),k=f,t=m({id:0,name:"",status:1}),u=I("formRef"),r={name:[{required:!0,message:"请输入角色名称",trigger:["blur","input"]}],status:[{required:!0,message:"请选择状态",type:"number",trigger:["blur","change"]}]};function g(){i.record&&(t.value=M({...i.record}))}function C(){t.value={id:0,name:"",status:1}}const _=m(!1);async function N(){var e;const[v]=await y(u.value.validate());if(v)return!1;_.value=!0;const[a]=await y(i.record?D(o(t)):E(o(t)));if(_.value=!1,!a)return(e=window.$message)==null||e.success(`${i.record?"编辑":"新增"}成功`),k("success"),!0}return(v,a)=>{const e=V,s=O,c=G,b=j,x=q,B=U;return T(),$(B,{show:d.value,"onUpdate:show":a[2]||(a[2]=w=>d.value=w),preset:"dialog",title:v.record?"编辑角色":"新增角色","positive-text":"确定","negative-text":"取消",loading:o(_),onAfterEnter:g,onAfterLeave:C,onPositiveClick:N},{default:l(()=>[n(x,{ref_key:"formRef",ref:u,model:o(t),rules:r,class:"my-8",size:"small","label-placement":"left","label-width":"auto"},{default:l(()=>[n(s,{label:"角色名称",path:"name"},{default:l(()=>[n(e,{value:o(t).name,"onUpdate:value":a[0]||(a[0]=w=>o(t).name=w),placeholder:"角色名称"},null,8,["value"])]),_:1}),n(s,{label:"状态",path:"status"},{default:l(()=>[n(b,{value:o(t).status,"onUpdate:value":a[1]||(a[1]=w=>o(t).status=w)},{default:l(()=>[n(c,{value:1},{default:l(()=>a[3]||(a[3]=[p("启用")])),_:1}),n(c,{value:0},{default:l(()=>a[4]||(a[4]=[p("禁用")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","loading"])}}}),te=R({name:"setting-role-list",__name:"index",setup(i){const f=m(!1),d=m([]),k=[{title:"id",key:"id",width:120},{title:"角色名称",key:"name"},{title:"状态",key:"status",width:120,render(e){return n(W,{type:e.status===1?"success":"error"},{default:()=>[e.status===1?"启用":"禁用"]})}},{title:"操作",key:"operation",width:260,fixed:"right",render(e){return n(Y,null,{default:()=>[n(h,{type:"primary",onClick:()=>_(e)},{default:()=>[p("编辑")]}),n(h,{type:"primary",onClick:()=>a(e)},{default:()=>[p("权限配置")]}),n(h,{type:"error",onClick:()=>N(e)},{default:()=>[p("删除")]})]})}}],t=M({page:1,pageSize:10,itemCount:0,onChange:e=>{t.page=e,u()}});async function u(){f.value=!0;const[e,s]=await y(P({current:t.page,size:t.pageSize}));if(f.value=!1,e){d.value=[];return}d.value=s.records,t.itemCount=s.total}u();const r=m(!1),g=m();function C(){g.value=void 0,r.value=!0}function _(e){g.value=e,r.value=!0}function N(e){const s=window.$dialog.warning({title:"温馨提示",content:`确定要删除“${e.name}”吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{s.loading=!0;const[c]=await y(F(e.id));return s.loading=!1,c?!1:(window.$message.success("删除成功"),u(),!0)}})}const{routerPushByName:v}=S();function a(e){v("setting-role-config",{params:{id:e.id}})}return(e,s)=>{const c=J,b=H;return T(),$(b,null,{default:l(()=>[n(o(h),{type:"primary",onClick:C},{default:l(()=>s[1]||(s[1]=[p(" 新增角色 ")])),_:1}),n(c,{class:"mt-4",columns:k,data:o(d),loading:o(f),remote:"",pagination:o(t),"scroll-x":620},null,8,["data","loading","pagination"]),n(K,{show:o(r),"onUpdate:show":s[0]||(s[0]=x=>L(r)?r.value=x:null),record:o(g),onSuccess:u},null,8,["show","record"])]),_:1})}}});export{te as default};
